<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Argo CD와 Github Action을 활용한 GitOps 시스템 구축 | JooHyoung Cha </title> <meta name="author" content="JooHyoung Cha"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://blog.udon.party/blog/2022/argocd-gitops/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">JooHyoung</span> Cha </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Argo CD와 Github Action을 활용한 GitOps 시스템 구축</h1> <p class="post-meta"> Created in March 04, 2022 by piorosen </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/argocd"> <i class="fa-solid fa-hashtag fa-sm"></i> argocd</a>   <a href="/blog/tag/cd"> <i class="fa-solid fa-hashtag fa-sm"></i> cd</a>   <a href="/blog/tag/github"> <i class="fa-solid fa-hashtag fa-sm"></i> github</a>   <a href="/blog/tag/gitops"> <i class="fa-solid fa-hashtag fa-sm"></i> gitops</a>   <a href="/blog/tag/k8s"> <i class="fa-solid fa-hashtag fa-sm"></i> k8s</a>   <a href="/blog/tag/github-action"> <i class="fa-solid fa-hashtag fa-sm"></i> github action</a>   ·   <a href="/blog/category/blogging"> <i class="fa-solid fa-tag fa-sm"></i> Blogging</a>   <a href="/blog/category/cloud"> <i class="fa-solid fa-tag fa-sm"></i> Cloud</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="개요">개요</h1> <p>Github Action을 통하여 CI를 구현 하였었다. CI를 구축하면서 자동으로 도커 허브까지 성공적으로 배포 하였지만 실제 서버에 배포하는 과정을 해보지 않았다. 그래서 현재 서버에서 사용 중인 Kubernetes에 CD를 구축 하여 자동 배포 서스템을 구축 하고자 했다. Kubernetes는 <a href="https://www.cncf.io/" rel="external nofollow noopener" target="_blank">CNCF</a> 재단에서 관리를 하고 있으며, <a href="https://www.cncf.io/projects/" rel="external nofollow noopener" target="_blank">CNCF 재단에서 관리하는 프로젝트</a>에서 Kubernetes에서 Continuous Delivery(이하 CD) 소프트웨어인 ArgoCD를 선택하게 되었다. 그 외에 다양한 업체를 만나보거나 커뮤니티에 이야기를 나눠보면서 가장 많이 거론이 되면서 많이 쓰이고 있던것이 ArgoCD가 이였기 때문에 ArgoCD를 선택해 보았다.</p> <h1 id="적용">적용</h1> <p>현재 Kubernetes를 SaaS, PaaS 형식으로 만들어주는 소프트웨어를 개발하고 있다. 그 중 Client와 통신하여 로그인 토큰 발급, 계정 관리를 담당하는 서버를 우선 개발하고 있다. 그래서 해당 서버를 개발하면서 로컬로 매번 테스트를 진행 하였다. 하지만 집에서 윈도우, 학교나 외부에서는 맥으로 개발을 진행 하다 보니 외부에 있고 서버가 한 군데에서 관리가 되면 좋겠다는 생각이 들어 CD 작업을 하고자 하였다. 적용을 해 본것은 GitOps이며 코드를 작성하고 빌드, 컨테이너 저장소에 푸시, 실제 서버에 배포가 되는 과정을 구축해 보았다.</p> <p>먼저 현재 구축한 CI/CD 구조는 개발자가 모든 개발을 완료 한 뒤에 태그를 푸시하면 자동적으로 배포가 되는 구조이다. 그래서 개발자가 v1.0.0 이라고 태그를 푸시하게 되면 Github Action에서 트리거가 발생해 Dockerfile을 빌드하고 Docker Hub에 빌드된 내용을 푸시 한다. 그리고 Docker Hub에 푸시 할 때 태그 정보는 v1.0.0 에서 v를 제외한 1.0.0으로 태그를 붙인다. 여기 까지 CI의 구조이고 CD는 ArgoCD의 경우 특정 레포지토리의 커밋, 태그 정보가 변경이 되면 Sync하여 쿠버네티스에 적용하기 때문에 Github Action에서 CD 작업은 특정 레포지토리에 변경점을 푸시 한다. 그렇게 되면 ArgoCD에서 약 3분 간격으로 Git의 내용을 읽어 변경점을 쿠버네티스에 적용, 배포를 하게 된다.</p> <p class="text-center"><img src="/assets/img/post/2022-03-04-workflow.png" alt="argocd"> <br>CI/CD 구조</p> <p class="text-center"><img src="/assets/img/post/2022-03-04-argocd.png" alt="argocd"> <br>현재 동작하고 있는 ArgoCD</p> <h1 id="5가지의-manifest">5가지의 Manifest</h1> <blockquote> <ol> <li>Database의 PVC</li> <li>Database의 Deployment</li> <li>외부 통신을 위한 Server-Comm의 NodePort</li> <li>Database가 통신을 위한 ClusterIP</li> <li>Server-Comm의 Deployment</li> </ol> </blockquote> <p>총 5가지의 Manifest가 있습니다. 그 중 스토리지, 외, 내부망과 통신을 위한 Service, 실제 서버가 중지가 되지 않기 위한 Deployment가 있습니다.</p> <h1 id="github-action의-ci--cd-코드">Github Action의 CI / CD 코드</h1> <p>Github Action에서 CI / CD를 자동화 하기 위해서 사용했던 코드는 아래와 같습니다. 현재 작업을 하고 있는 프로젝트는 <a href="https://github.com/aswcloud" rel="external nofollow noopener" target="_blank">AswCloud</a>란 Organization이며 <a href="https://github.com/aswcloud/server-comm" rel="external nofollow noopener" target="_blank">로그인 서버</a>와 <a href="https://github.com/aswcloud/server-k8s" rel="external nofollow noopener" target="_blank">쿠버네티스 통신 서버</a>, <a href="https://github.com/aswcloud/idl" rel="external nofollow noopener" target="_blank">통신 모듈</a>, <a href="https://github.com/aswcloud/client-ios" rel="external nofollow noopener" target="_blank">iOS 사용자</a>, <a href="https://github.com/aswcloud/argo-cd" rel="external nofollow noopener" target="_blank">CD를 위한 레포지토리</a> 이렇게 프로젝트가 구성이 되어 있습니다.</p> <p class="text-center"><a href="https://github.com/aswcloud/server-comm/blob/main/.github/workflows/docker-image.yml" rel="external nofollow noopener" target="_blank"><img src="https://opengraph.githubassets.com/d1c94cbd3f9528f3f94f1eddc5c2e35388f99a05c865544b4e66670aa23122b7/aswcloud/server-comm" alt="이미지"></a> <br>CI / CD를 구축한 Github Action 코드</p> <h1 id="구축-하면서-생긴-오류">구축 하면서 생긴 오류</h1> <p>구축은 총 4~6시간 정도 걸렸다. ArgoCD를 구축 하면서 그렇게 많은 시간이 걸린 이유는 ArgoCD가 어떻게 동작하는지 알아야 환경 구축을 어떻게 할지 감을 잡는게 2~3시간 정도 걸렸다. 특히 ArgoCD를 사용 하기 위해서 레포지토리에 k8s의 yaml 파일이 있어야하고 yaml의 값의 변경 유무 확인하는 방식이라는 걸 아는게 오래 걸렸다. (책으로 빠르게 구조를 인식하고 구현 하려고 했지만 블로그 자료 같은 곳에서 자료가 정말 없어서.. 레포지토리를 확인해야 했었다.) 그 외에는 Github Action에서 레포지토리를 푸시 하거나, CD 할 때 yaml을 수정하고 푸시 해주는 프로그램을 찾는것에서 오래 걸렸다. (작업 하고, 테스트 하기 위해서 약 70커밋 정도 했다..)</p> <h1 id="후기">후기</h1> <p>기존에 서버를 구축해서 사용 할 때 매번 코드를 작성하고, 빌드 한 결과물을 서버에 직접 올려 실행 시켜야 했지만 ArgoCD를 사용하면서 모든 작업이 자동적으로 동작 하니, 순수 코드에만 집중 할 수 있는 환경이 되니 정말 쾌적했다. 정말 너무 좋다.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://blog.google/technology/ai/google-gemini-update-flash-ai-assistant-io-2024/" target="_blank" rel="external nofollow noopener">Google Gemini updates: Flash 1.5, Gemma 2 and Project Astra</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://medium.com/@al-folio/displaying-external-posts-on-your-al-folio-blog-b60a1d241a0a?source=rss-17feae71c3c4------2" target="_blank" rel="external nofollow noopener">Displaying External Posts on Your al-folio Blog</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Winograd-Algorithm/">위노그라드 알고리즘 정리</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/ssh-vpn-forward/">외부에서 내부망으로 접근하기 위한 3가지의 방법론</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/GIST-Developer/">GIST Developers' Night 2024에 연사로 참가하고 나서</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 JooHyoung Cha. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>